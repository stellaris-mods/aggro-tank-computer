namespace = folktanks

# XXX
# So apparently awakened_fallen_empire doesnt use normal ships
#			massive_ship_fallen_empire = {
#				min = 1
#				max = 3
#				planet_mult = 0.05
#			}
#
#			large_ship_fallen_empire = {
#				fraction = {
#					base = 35
#				}
#			}
#			small_ship_fallen_empire = {
#				fraction = {
#					base = 65
#				}
#			}

event = {
	id = folktanks.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = {
				is_ai = yes
				is_country_type = "default"
				has_technology = "tech_combat_computers_1"
				has_technology = "tech_spaceport_3" # Destroyer or higher can be tanks
				not = {
					has_country_flag = "folk_tanks_ai_use"
				}
				count_owned_ships = {
					limit = { has_ship_flag = "aggro_tank" }
					count < 7
				}
				minerals > 600
			}
			random = {
				chance = 10 # Monthly chance

				# Base build time for Destroyer is 60, but earlier in the
				# game it's probably around 80, so give the AI 3 months
				# to start construction
				set_timed_country_flag = {
					flag = "folk_tanks_ai_use"
					days = 4
				}
				# Force-trigger automatic ship design upgrades
				# To enable tank computers
				give_technology = {
					tech = "tech_force"
					message = no
				}

				if = {
					# Should we produce a battleship?
					limit = {
						has_technology = "tech_spaceport_6"
						minerals > 3000
						count_owned_ships = {
							limit = {
								is_ship_size = battleship
								NOT = { has_ship_flag = "aggro_tank" }
							}
							count > 4
						}
					}
					create_fleet = {
						#name = random
						settings = { can_upgrade = no }
						effect = {
							set_owner = prev
							set_location = {
								target = prev.capital_scope
								distance = 15
								angle = random
							}
							create_ship = {
								name = random
								random_existing_design = "battleship"
								effect = { set_ship_flag = "aggro_tank" }
							}
						}
					}
					add_minerals = -3000
					else = {
						if = {
							# Should we produce a cruiser?
							limit = {
								has_technology = "tech_spaceport_5"
								minerals > 1500
								count_owned_ships = {
									limit = {
										is_ship_size = cruiser
										NOT = { has_ship_flag = "aggro_tank" }
									}
									count > 4
								}
							}
							create_fleet = {
								#name = random
								settings = { can_upgrade = no }
								effect = {
									set_owner = prev
									set_location = {
										target = prev.capital_scope
										distance = 15
										angle = random
									}
									create_ship = {
										name = random
										random_existing_design = "cruiser"
										effect = { set_ship_flag = "aggro_tank" }
									}
								}
							}
							add_minerals = -1500
							else = {
								if = {
									# Should we produce a destroyer?
									limit = {
										minerals > 600
										count_owned_ships = {
											limit = {
												is_ship_size = destroyer
												NOT = { has_ship_flag = "aggro_tank" }
											}
											count > 6
										}
									}
									create_fleet = {
										#name = random
										settings = { can_upgrade = no }
										effect = {
											set_owner = prev
											set_location = {
												target = prev.capital_scope
												distance = 15
												angle = random
											}
											create_ship = {
												name = random
												random_existing_design = "destroyer"
												effect = { set_ship_flag = "aggro_tank" }
											}
										}
									}
									add_minerals = -600
								}
							}
						}
					}
				}
				# Force-trigger automatic ship design upgrades
				# To REMOVE tank computers from designs
				country_event = {
					id = folktanks.2
					days = 5
				}
			}
		}
	}
}

country_event = {
	id = folktanks.2
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		give_technology = {
			tech = "tech_force"
			message = yes
		}
	}
}
